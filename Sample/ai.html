<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neural Interface CMD with Memory</title>
<style>
html, body {
  margin: 0;
  height: 100%;
  background: #000;
  font-family: "Consolas", monospace;
  color: #fff;
  overflow: hidden;
}

#terminal {
  height: 100vh;
  padding: 5px;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  white-space: pre-wrap;
}

.line {
  margin-bottom: 2px;
}

.prompt {
  display: inline;
}

.input {
  display: inline;
  outline: none;
  border: none;
  background: transparent;
  color: #fff;
  font-family: "Consolas", monospace;
  font-size: 1rem;
}
</style>
</head>
<body>

<div id="terminal"></div>

<script type="module">
import * as webllm from "https://esm.run/@mlc-ai/web-llm";

const terminal = document.getElementById("terminal");

const MODEL = "Llama-3.2-1B-Instruct-q4f32_1-MLC";
const engine = new webllm.MLCEngine();

// Store all previous messages for AI memory
let messageHistory = [
  { role: "system", content: "You are a helpful AI assistant. Remember the conversation history." }
];

function addLine(text) {
  const div = document.createElement("div");
  div.className = "line";
  div.textContent = "C:\\NeuralInterface> " + text;
  terminal.appendChild(div);
  terminal.scrollTop = terminal.scrollHeight;
}

async function newPrompt() {
  const div = document.createElement("div");
  div.className = "line";

  const prompt = document.createElement("span");
  prompt.className = "prompt";
  prompt.textContent = "C:\\NeuralInterface> ";
  div.appendChild(prompt);

  const input = document.createElement("span");
  input.className = "input";
  input.contentEditable = "true";
  input.spellcheck = false;
  div.appendChild(input);

  terminal.appendChild(div);
  input.focus();

  const submit = async () => {
    const cmd = input.textContent.trim();
    if (!cmd) return;

    // Freeze current line
    input.contentEditable = "false";
    input.textContent = cmd;

    // Add user command to history
    messageHistory.push({ role: "user", content: cmd });

    // Show processing
    addLine("Processing...");

    const res = await engine.chat.completions.create({
      messages: messageHistory,
      temperature: 0.7,
      max_tokens: 300
    });

    // Remove Processing line
    terminal.removeChild(terminal.lastChild);

    // Show AI response
    const aiText = res.choices[0].message.content;
    addLine(aiText);

    // Add AI response to history
    messageHistory.push({ role: "assistant", content: aiText });

    // Start new prompt
    newPrompt();
  };

  input.addEventListener("keydown", async (e) => {
    if (e.key === "Enter") {
      e.preventDefault(); // prevent new line
      submit();
    }
  });
}

// Initial lines
addLine("Initializing neural core...");
addLine("Loading modelâ€¦ this may take a minute on first run.");

await engine.reload(MODEL);
addLine("Neural core online.");

// Start first prompt
newPrompt();
</script>

</body>
</html>
